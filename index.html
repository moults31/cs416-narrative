<html>
<script src='https://d3js.org/d3.v5.min.js'></script>
<style> circle {fill: lightblue; stroke: black;} </style>
<body onload='init()'>
<svg width=300 height=300>
</svg>
<script>

var currentScene = 0;
async function init() {

  scatterPlot();

  document.querySelector("body").addEventListener("click", evt => {
    const button = evt.target.closest("button");
    if (button) {
      switchScene(button.dataset.value); // Evaluate the game's next transition with our input
    }
  });

}

function switchScene(value) {  
  // Update global currentScene var
  if(value == 3){
    currentScene = (currentScene + 1) % 3;
  } else {
    currentScene = value;
  }

  // Update view
  d3.selectAll('svg').selectAll("*").remove();
  if(currentScene == 0){
      scatterPlot();
  } else if(currentScene == 1){
      barChart();
  } else {
      ;
  }
}

async function scatterPlot() {
  const data = await d3.csv(
    "https://flunky.github.io/cars2017.csv");

  ys = d3.scaleLog().domain([150,10]).range([0,200]);
  xs = d3.scaleLog().domain([10,150]).range([0,200]);

  d3.select('svg')
    .append('g')
    .attr("transform", "translate(50, 50)")
    .call(d3.axisLeft(ys)
            .tickValues([10, 20, 50, 100])
            .tickFormat(d3.format("~s")));

  d3.select('svg')
    .append('g')
    .attr("transform", "translate(50, 250)")
    .call(d3.axisBottom(xs)
            .tickValues([10, 20, 50, 100])
            .tickFormat(d3.format("~s")));

  d3.select('svg')
    .append('g')
    .attr("transform", "translate(50, 50)")
    .selectAll('p')
    .data(data)
    .enter()
    .append('circle')
      .attr('cx', function(d) {return xs(d.AverageCityMPG);})
      .attr('cy', function(d) {return ys(d.AverageHighwayMPG);})
      .attr('r', function(d) {return 2 + parseInt(d.EngineCylinders);})
      .style('fill', 'lightblue');
}

// Bar chart adapted from https://www.tutorialsteacher.com/d3js/create-bar-chart-using-d3js
async function barChart() {
  const data = await d3.csv(
    "https://flunky.github.io/cars2017.csv");

  height = 50
  width = 200

  var xScale = d3.scaleBand().range([0, width]).padding(0.4),
    yScale = d3.scaleLinear().range([height, 0]);
  xScale.domain([10,150]);
  yScale.domain([150,10]);

  d3.select('svg')
    .append('g')
        .attr("transform", "translate(50, 50)")
        .call(d3.axisBottom(xScale));

  d3.select('svg')
    .append('g')
        .call(d3.axisLeft(yScale).tickFormat(function(d){
            return "$" + d;
        }).ticks(10))
        .append("text")
        .attr("y", 6)
        .attr("dy", "0.71em")
        .attr("text-anchor", "end")
        .text("value");

  d3.select('svg')
    .append('g')
    .attr("transform", "translate(50, 50)")
    .selectAll('p')
    .data(data)
    .enter()
    .append('rect')
      .attr('x', function(d,i) {return i * 10;})
      .attr('y', function(d) { return yScale(d.AverageHighwayMPG); })
      .attr("width", xScale.bandwidth())
      .attr("height", function(d) { return height - yScale(d.AverageHighwayMPG); })
      .style('fill', 'lightblue');
}

// Adapted from https://www.javatpoint.com/how-to-create-dropdown-list-using-javascript
function processDropDown() {  
    var mylist = document.getElementById("myList");  
    document.getElementById("favourite").value = mylist.options[mylist.selectedIndex].text;  
}


</script>
<b> Select scene (go in order!) </b>  
<button data-value="0">0</button>
<button data-value="1">1</button>
<button data-value="2">2</button>
<button data-value="3">Next</button>
<output></output>

<form>  
    <b> Select you favourite tutorial site using dropdown list </b>  
    <select id = "myList" onchange = "processDropDown()" >  
    <option> ---Choose tutorial--- </option>  
    <option> w3schools </option>  
    <option> Javatpoint </option>  
    <option> tutorialspoint </option>  
    <option> geeksforgeeks </option>  
    </select>  
    <p> Your selected tutorial site is:   
    <input type = "text" id = "favourite" size = "20" </p>  
</form>  
</body>
</html>

